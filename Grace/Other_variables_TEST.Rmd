---
title: "Version3"
author: "Grace Yan"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(readr)
library(plyr)

myfiles <- list.files(path = "/home/cr23868/Documents/Tennis/R_code/tennis_wta-master_test", pattern = ".csv", full.names=TRUE)
dat_csv_test <- ldply(myfiles, read_csv)
```

```{r, message=FALSE}
library(tidyr)
library(dplyr)

##### Extracting necessary columns and removing NAs
data_test <- data.frame(dat_csv_test[,c("winner_id", "winner_name", "winner_hand", "winner_ht", "w_ace", "w_df", "w_svpt", "w_1stIn", "w_1stWon",
                              "w_2ndWon", "w_SvGms", "w_bpSaved", "w_bpFaced", "loser_id", "loser_name", "loser_hand", "loser_ht",
                              "l_ace", "l_df", "l_svpt", "l_1stIn", "l_1stWon", "l_2ndWon", "l_SvGms", "l_bpSaved",
                              "l_bpFaced", "surface")])
data_test <- na.omit(data_test)
detach(data)
attach(data_test)
```

Selecting matches that only contain the players we considered during training:

```{r}
indices_test <- winner_name %in% players == TRUE & loser_name %in% players
matches_test <- data.frame( Winner=factor(winner_name[indices_test]), Loser=factor(loser_name[indices_test]) ) # 1954 matches
players_test <- unique( c(matches_test[,1], matches_test[,2]) ) # 215 players
# Make sure Winner and Loser factors have same number of levels as # players
levels(matches_test$Winner) <- levels(players_test)
levels(matches_test$Loser) <- levels(players_test)

# Get the variables we want
variables <- func(matches_test, data_test, indices_test)
```

## Using predict()

```{r}
# Add in columns for new variables
winners_test <- data.frame(Player=matches_test[,1], variables$w_output)
losers_test <- data.frame(Player=matches_test[,2], variables$l_output)
# Combine everything into a single list
data_for_model_test <- list(winners=winners_test, losers=losers_test, predictors=predictors[players_test,] )
View(data_for_model_test)

# Make predictions
pred <- predict(model, newdata=data_for_model_test, type="response", se.fit=TRUE)
pred2 <- predict(model, newdata=data_for_model_test, se.fit=TRUE)
View(pred)
```

